<div class="modal fade" id="ordersListing" tabindex="9" role="modal" aria-labelledby="modal-label" aria-hidden="true" style="display: none; overflow-y: auto !important;">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			</div>
			<h4 class="text-green">Gérer les vélos commandables</h4>
			<div class="table-responsive">
				<table id="companiesOrderable" class="table" style="width: 100%;"></table>
			</div>
			<script>
			$('.ordersManagerClick').click(function () {
				$('#companiesOrderable').dataTable({
					destroy: true,
					"ajax": {
						"url" : "apis/Kameo/companies/companies.php",
						"contentType": "application/json",
						"type": "GET",
						"data": {
							"action": "listCafetariaCompanies"
						}
					},
					"sAjaxDataProp": "",
					columnDefs: [
						{ width: "100%", targets: 0 }
					],
					"columns": [
						{ title: "Name", "data": "COMPANY_NAME", 
							"fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
								var cafetaria = (oData.CAFETARIA === "Y") ? true : false;
								var discount = oData.DISCOUNT;
                                console.log(discount);
								$(nTd).html("<a href='#' data-target='#manageOrderable' data-toggle='modal' data-cafetaria='"+cafetaria+"'data-discount='"+discount+"' data-company='"+sData+"'>"+sData+"</a>");
							}
						},
						{ title: "Bikes", "data": "NUM_OF_ORDERABLE" },
						{ title: "Cafetaria", "data": "CAFETARIA" },
					],
					"order": [[ 2, "desc" ], [ 0, "asc" ]]
				});
			});
			</script>
			<div class="separator"></div>
			<h4 class="text-green">Gérer les commandes</h4>
			<div data-example-id="contextual-table" class="bs-example">
				<span id="ordersListingSpan"></span>
			</div>
			<div class="fr" class="modal-footer">
				<button type="button" class="btn btn-b" data-dismiss="modal">Fermer</button>
			</div>
			<div class="en" class="modal-footer">
				<button type="button" class="btn btn-b" data-dismiss="modal">Close</button>
			</div>
			<div class="nl" class="modal-footer">
				<button type="button" class="btn btn-b" data-dismiss="modal">Sluiten</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$('.form_date_start_client').datetimepicker({
		language:  'fr',
		weekStart: 1,
		todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		minView: 2,
		forceParse: 0
	});
	$('.form_date_end_client').datetimepicker({
		language:  'fr',
		weekStart: 1,
		todayBtn:  1,
		autoclose: 1,
		todayHighlight: 1,
		startView: 2,
		minView: 2,
		forceParse: 0
	});
	$('.form_date_start_client').change(function(){
		generateCompaniesGraphic($('.form_date_start_client').data("datetimepicker").getDate(), $('.form_date_end_client').data("datetimepicker").getDate());
	});
	$('.form_date_end_client').change(function(){
		generateCompaniesGraphic($('.form_date_start_client').data("datetimepicker").getDate(), $('.form_date_end_client').data("datetimepicker").getDate());
	});
</script>


<div class="modal fade" id="orderManagerFleet" tabindex="-1" role="modal" aria-labelledby="modal-label" aria-hidden="true" style="display: none;">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-sm-12">
						<form id="widget-orderFleet-form" action="apis/Kameo/orders_management.php" role="form" method="post">
                          <fieldset disabled>
							<h4 class="fr text-green">Gestion de la commande client</h4>
							<h4 class="nl text-green">Management of client order</h4>
							<h4 class="en text-green">Management of client order</h4>
							<div class="form-group col-sm-12">
								<div class="col-sm-12">
									<h4 class="fr text-green">Informations techniques</h4>
									<h4 class="nl text-green">Technical information</h4>
									<h4 class="en text-green">Technical information</h4>
									<div class="col-sm-4">
										<label for="ID">ID commande</label>
										<input type="text" name="ID" class="form-control required" readonly>
									</div>
									<div class="col-sm-4">
										<label for="status"  class="fr">Statut</label>
										<label for="status"  class="en">Status</label>
										<label for="status"  class="nl">Status</label>
										<select name="status" disabled>
											<option value="new">Nouvelle demande</option>
											<option value="ongoing">En cours</option>
											<option value="confirmed">Confirmée</option>
											<option value="refused">Refusée</option>
										</select>
									</div>
								</div>
							</div>
							<div class="form-group col-sm-12">
								<h4 class="fr text-green">Caractéristiques du vélo</h4>
								<h4 class="nl text-green">Bike characteristics</h4>
								<h4 class="en text-green">Bike characteristics</h4>
								<div class="col-sm-12">
									<div class="col-sm-4">
										<label for="brand"  class="fr">Marque</label>
										<label for="brand"  class="en">Brand</label>
										<label for="brand"  class="nl">Brand</label>
										<input type="text" name="brand" class="form-control required" disabled>
									</div>
									<div class="col-sm-4">
										<label for="model"  class="fr">Modèle</label>
										<label for="model"  class="en">Model</label>
										<label for="model"  class="nl">Model</label>
										<input type="text" name="model" class="form-control required" disabled>
									</div>
									<div class="col-sm-4">
										<label for="frameType"  class="fr">Type de cadre</label>
										<label for="frameType"  class="en">Frame Type</label>
										<label for="frameType"  class="nl">Frame Type</label>
										<select name="frameType" class="form-control" disabled>
											<option value="H">Homme</option>
											<option value="M">Mixte</option>
											<option value="F">Femme</option>
										</select>
									</div>
									<div class="col-sm-4">
										<label for="size"  class="fr">Taille</label>
										<label for="size"  class="en">Size</label>
										<label for="size"  class="nl">Size</label>
										<select name="size">
											<option value="XS">XS</option>
											<option value="S">S</option>
											<option value="M">M</option>
											<option value="L">L</option>
											<option value="XL">XL</option>
										</select>
									</div>
									<img class="commandBike" width="200" title="vélo commandé" alt="vélo commandé"/>
								</div>
							</div>
							<div class="form-group col-sm-12">
                                <h4 class="text-green">Montant de facturation</h4>
                                <div class="col-sm-4">
                                    <label for="brand">Valeur marchande (HTVA)</label>
                                    <input type="text" name="retailPrice" class="form-control required" disabled>
                                    
                                </div>
                                <div class="col-sm-4">
                                    <label for="model"  class="fr">Montant leasing</label>
                                    <input type="text" name="leasingPrice" class="form-control required" disabled>                                    
                                </div>
                            </div>
                              
                            </fieldset>
                            
                            <div class="col-sm-12">
                                <a class="button small red-dark button-3d rounded icon-right\" ID="initializeRefuseCommandButton"><span>Refuser</span></a>       
                                <button  class="button small green button-3d rounded icon-left" ID="confirmCommandButton" name="validationComand" type="submit"><i class="fa fa-paper-plane"></i>Valider</button>
                            </div>                           
                            
                            <input type="text" name="action" class="hidden" value="confirmCommand">
                            
						</form>
						<form id="widget-refuseCommand-form" class="hidden" action="apis/Kameo/orders_management.php" role="form" method="post">
                            <h4 class="text-green">Raison du refus</h4>
                            <textarea type="text" name="reasonOfRefusal" rows="5" class="form-control required" placeholder="Votre message"></textarea>
                            <input type="text" name="action" class="hidden" value="refuse">
                            <input type="text" name="ID" ID="ID" class="hidden" value="refuse">
                            <button  class="button small green button-3d rounded icon-left" name="validationComand" type="submit"><i class="fa fa-paper-plane"></i>Valider</button>
                        </form>
                        
					</div>
				</div>
				<div class="fr" class="modal-footer">
					<button type="button" class="btn btn-b" data-dismiss="modal">Fermer</button>
				</div>
				<div class="en" class="modal-footer">
					<button type="button" class="btn btn-b" data-dismiss="modal">Close</button>
				</div>
				<div class="nl" class="modal-footer">
					<button type="button" class="btn btn-b" data-dismiss="modal">Sluiten</button>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
    jQuery("#widget-orderFleet-form").validate({
		submitHandler: function(form) {
			jQuery(form).ajaxSubmit({
				success: function(response) {
					if (response.response == 'success') {
						$.notify({
							message: response.message
						}, {
							type: 'success'
						});
						get_orders_fleet_listing();
						$('#orderManagerFleet').modal('toggle');
						document.getElementById('widget-orderFleet-form').reset();
					} else {
						$.notify({
							message: response.message
						}, {
							type: 'danger'
						});
					}
				}
			});
		}
    });
    jQuery("#widget-refuseCommand-form").validate({
		submitHandler: function(form) {
			jQuery(form).ajaxSubmit({
				success: function(response) {
					if (response.response == 'success') {
						$.notify({
							message: response.message
						}, {
							type: 'success'
						});
						get_orders_fleet_listing();
						$('#orderManagerFleet').modal('toggle');
						document.getElementById('widget-orderFleet-form').reset();
                        
                          var element = document.getElementById("widget-refuseCommand-form");
                          element.classList.add("hidden");

                          var element = document.getElementById("initializeRefuseCommandButton");
                          element.classList.remove("hidden");

                          var element = document.getElementById("confirmCommandButton");
                          element.classList.remove("hidden");
                        
                        
                        
					} else {
						$.notify({
							message: response.message
						}, {
							type: 'danger'
						});
					}
				}
			});
		}
    });
</script>